{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Homepage","text":""},{"location":"#mavis-calibration-tests-using-hector-data","title":"MAVIS calibration tests using Hector data","text":"<p>This repository contains code which takes some raw exposures of various different Hector calibration lamps and measures their fluxes in ADU/s as a function of wavelength. This will be useful for the MAVIS team.</p> <p>The analysis steps are:</p> <ul> <li>Subtract off the dark frame (if we have one) or just the bias level (if we don't) and turn the 2D image into a 1D spectrum (<code>save_1d_spec.py</code>).</li> <li>Get a wavelength calibration for the spectrum (<code>apply_wavelength_calibration.py</code>).</li> <li>Find some bright lines and measure their fluxes by summing across a range of pixels (<code>measure_fluxes.py</code>).</li> </ul> <p>A short summary of all of these is below.</p>"},{"location":"#running-this-code","title":"Running this code","text":"<p>If you'd like to run the code, please clone the repo, create a new python environment (with either <code>conda</code> or <code>venv</code>) and run <code>pip install .</code> from the main folder. You'll also need the raw data which I've prepared (by editing some filenames, etc). I've passed this on to Richard McDermid. Place it in the <code>src/data/raw</code> folder.</p> <p>You can then run <code>snakemake --cores 1</code> from the main folder to re-run the analysis on all of the files. It should take a couple of minutes to finish.</p>"},{"location":"#the-analysis-steps","title":"The analysis steps","text":""},{"location":"#making-1d-spectra","title":"Making 1D spectra","text":"<p>The file <code>src/scripts/save_1d_spec.py</code> does the following things:</p> <ul> <li>Reads the input file.</li> <li>Subtracts the bias from the image. If we have a dark frame, this is subtracted. Otherwise, we calculate a bias level using <code>np.nanmedian(image)</code>. There's a check to make sure that this value isn't huge or tiny, but this really isn't very accurate. Be careful about using the files which don't have dark exposures!</li> <li>Gets the exposure time and the arc lamp name from the filename.</li> <li>Sums the image along the spatial dimension <code>(axis=0)</code> to go from 2D to 1D.</li> <li>Saves a plot of this spectrum for QC.</li> <li>Saves a 1D fits file with appropriate header keywords.</li> </ul> <p>The raw input images look like this:</p> <p></p> <p>Note that there looks to be a bias difference on each half of the detector: it's roughly 500 counts on the left and 504 on the right. This is currently ignored in the analysis when we don't have a dark frame. </p> <p>We then collapse them down into a 1D spectrum, which looks like this:</p> <p></p>"},{"location":"#getting-a-wavelength-calibration","title":"Getting a wavelength calibration","text":"<p>I'm assuming that the wavelength calibration for this data is roughly the same as previously reduced Hector data, so I'm using the same calibration as there. This is probably only good to a few Angstroms or so (2-5 pixels).</p> <p>Looking at a handful of previously reduced arc frames, their wavelength solutions are below. For the blue:</p> CRVAL CRPIX CDELT 0.542... 2048 4837.4... 0.547... 2048 4799.7... 0.547... 2048 4799.7... 0.547... 2048 4799.7... 0.542... 2048 4837.4... 0.547... 2048 4799.7... 0.547... 2048 4799.7... <p>and for the red:</p> CRVAL CRPIX CDELT 0.520... 2048 6754.7... 0.518... 2048 6781.9... 0.518... 2048 6781.9... 0.520... 2048 6754.7... 0.520... 2048 6754.7... 0.520... 2048 6754.7... 0.520... 2048 6754.7... 0.520... 2048 6754.7... 0.520... 2048 6754.7... 0.520... 2048 6754.7... <p>I'm therefore going to take the most common wavelength solution here: (0.5470085470085, 2048, 4799.726495726) for the blue and (0.5201465201465, 2048, 6754.73992674) for the red.</p>"},{"location":"#summing-the-emission-lines-to-measure-fluxes","title":"Summing the emission lines to measure fluxes","text":"<p>The file <code>measure_line_fluxes.py</code> does the following things:</p> <ul> <li>Reads in a <code>.csv</code> file which has the line definitions (start, stop in Angstroms)</li> <li>Sums the flux between these wavelengths</li> <li>Calculates the number of ADUs per second by dividing by the exposure time and the number of fibres in a Hexabundle (which is 61).</li> <li>Saves the table with all these measurements in.</li> <li>Saves a QC plot of where the line definitions are in the spectrum, an example of which is shown below.</li> </ul> <p></p> <p>The final tables are saved in <code>src/data/results</code> as a <code>.csv</code> file. The columns are \"pixel\", which gives the central pixel of the line, \"Wavelength\", which gives the central wavelength of the line, and \"Flux\", which is the number of ADUs per second measured for that line.</p>"}]}